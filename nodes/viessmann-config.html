<script type="text/javascript">
    RED.nodes.registerType('viessmann-config', {
        category: 'config',
        defaults: {
            name: { value: "" },
            enableDebug: { value: false },
            scope: { value: "IoT User offline_access" }
        },
        credentials: {
            clientId: { type: "text" },
            clientSecret: { type: "password" }
        },
        label: function() {
            return this.name || "Viessmann Config";
        }
    });
</script>

<script type="text/html" data-template-name="viessmann-config">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-config-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-config-input-clientId"><i class="fa fa-user"></i> Client ID</label>
        <input type="text" id="node-config-input-clientId" placeholder="Client ID">
    </div>
    <div class="form-row">
        <label for="node-config-input-clientSecret"><i class="fa fa-lock"></i> Client Secret</label>
        <input type="password" id="node-config-input-clientSecret" placeholder="Client Secret">
    </div>
    <div class="form-row">
        <label for="node-config-input-scope"><i class="fa fa-key"></i> OAuth2 Scopes</label>
        <input type="text" id="node-config-input-scope" placeholder="IoT User offline_access">
    </div>
    <div class="form-row">
        <label for="node-config-input-enableDebug"><i class="fa fa-bug"></i> Enable Debug Logging</label>
        <input type="checkbox" id="node-config-input-enableDebug" style="display:inline-block; width:auto; vertical-align:baseline;">
    </div>
</script>

<script type="text/html" data-help-name="viessmann-config">
    <p>Configuration node for Viessmann API authentication using OAuth2.</p>
    
    <h3>Setup</h3>
    <p>To use this node, you need credentials from the Viessmann Developer Portal:</p>
    <ol>
        <li>Visit <a href="https://developer.viessmann.com/" target="_blank">Viessmann Developer Portal</a></li>
        <li>Log in with your Viessmann account</li>
        <li>Create a new client in "My Dashboard" under "Your clients"</li>
        <li>Note your Client ID and Client Secret</li>
    </ol>
    <p>For detailed instructions, see the <a href="https://api.viessmann-climatesolutions.com/documentation/static/authentication" target="_blank">Viessmann API Authentication Documentation</a></p>
    
    <h3>Configuration</h3>
    <dl class="message-properties">
        <dt>Name <span class="property-type">string</span></dt>
        <dd>Optional friendly name for this configuration</dd>
        
        <dt>Client ID <span class="property-type">string</span></dt>
        <dd>Your application's Client ID from the Viessmann Developer Portal</dd>
        
        <dt>Client Secret <span class="property-type">string</span></dt>
        <dd>Your application's Client Secret from the Viessmann Developer Portal (stored securely)</dd>
        
        <dt>OAuth2 Scopes <span class="property-type">string</span></dt>
        <dd>Space-separated OAuth2 scopes. Default: <code>IoT User offline_access</code></dd>
        
        <dt>Enable Debug Logging <span class="property-type">boolean</span></dt>
        <dd>Enable detailed logging for troubleshooting authentication issues (sensitive data is masked)</dd>
    </dl>
    
    <h3>Authentication</h3>
    <p>This node uses OAuth2 client credentials flow with the endpoint: <code>https://iam.viessmann.com/idp/v3/token</code></p>
    <p>Tokens are automatically refreshed before expiration. All credentials and tokens are stored securely using Node-RED's credential system.</p>
    
    <h3>Troubleshooting</h3>
    <p>If authentication fails, enable debug logging to see detailed error messages. Check that your Client ID and Client Secret are correct and that your application is properly configured in the Developer Portal.</p>
</script>
